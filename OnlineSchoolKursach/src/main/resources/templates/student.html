<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–∞–Ω–µ–ª—å —É—á–µ–Ω–∏–∫–∞ - SupSchool</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/custom-theme.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/user-settings.js"></script>
    <script src="/js/teacher-hotkeys.js"></script>
    <script>

        window.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, toggleTheme available:', typeof window.toggleTheme);
            if (typeof window.toggleTheme !== 'function') {
                console.error('toggleTheme is not a function!');
            }
        });
    </script>
    <style>
        .student-card {
            transition: transform 0.2s;
        }
        .student-card:hover {
            transform: translateY(-5px);
        }
        .tab-content {
            min-height: 400px;
        }
        .course-card {
            transition: transform 0.2s;
            border: 1px solid #dee2e6;
        }
        .course-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .calendar-day {
            min-height: 120px;
            border: 1px solid #dee2e6;
            padding: 10px;
            background-color: #fff;
        }
        .calendar-day.today {
            background-color: #e7f3ff;
            border: 2px solid #0d6efd;
        }
        .calendar-day-header {
            font-weight: bold;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #dee2e6;
        }
        .task-item {
            background-color: #f8f9fa;
            border-left: 3px solid #0d6efd;
            padding: 5px 8px;
            margin-bottom: 5px;
            border-radius: 3px;
            font-size: 0.85rem;
            cursor: pointer;
        }
        .task-item.urgent {
            border-left-color: #dc3545;
            background-color: #fff5f5;
        }
        .task-item.warning {
            border-left-color: #ffc107;
            background-color: #fffbf0;
        }
    </style>
</head>
<body class="bg-light" data-context="student-dashboard">
    <nav class="navbar navbar-expand-lg navbar-dark bg-info">
        <div class="container">
            <a class="navbar-brand text-white" href="/">SupSchool - –ü–∞–Ω–µ–ª—å —É—á–µ–Ω–∏–∫–∞</a>
            <div class="navbar-nav ms-auto d-flex align-items-center">
                <span class="navbar-text me-3 text-white" th:if="${#authentication != null}">
                    –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <span th:text="${#authentication.name}"></span>!
                </span>
                <button id="themeToggle" class="btn btn-sm btn-outline-light me-2" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
                    üåô
                </button>
                <a class="nav-link text-white" href="/logout">–í—ã–π—Ç–∏</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        
        <ul class="nav nav-tabs" id="studentTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="catalog-tab" data-bs-toggle="tab" data-bs-target="#catalog" type="button" role="tab" aria-controls="catalog" aria-selected="true">–ö–∞—Ç–∞–ª–æ–≥ –∫—É—Ä—Å–æ–≤</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="my-courses-tab" data-bs-toggle="tab" data-bs-target="#my-courses" type="button" role="tab" aria-controls="my-courses" aria-selected="false">–ú–æ–∏ –∫—É—Ä—Å—ã</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="calendar-tab" data-bs-toggle="tab" data-bs-target="#calendar" type="button" role="tab" aria-controls="calendar" aria-selected="false">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="certificates-tab" data-bs-toggle="tab" data-bs-target="#certificates" type="button" role="tab" aria-controls="certificates" aria-selected="false">–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile" type="button" role="tab" aria-controls="profile" aria-selected="false">–ü—Ä–æ—Ñ–∏–ª—å</button>
            </li>
        </ul>

        
        <div class="tab-content" id="studentTabsContent">
            
            <div class="tab-pane fade show active" id="catalog" role="tabpanel" aria-labelledby="catalog-tab">
                <div class="row mt-4">
                    <div class="col-12">
                        <h3>–ö–∞—Ç–∞–ª–æ–≥ –∫—É—Ä—Å–æ–≤</h3>
                        <p class="text-muted">–ó–¥–µ—Å—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫—É—Ä—Å—ã. –í—ã –º–æ–∂–µ—Ç–µ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ª—é–±–æ–π –∫—É—Ä—Å, –∫–æ—Ç–æ—Ä—ã–π –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç.</p>
                    </div>
                </div>
                
                <div class="row mt-3">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <div class="d-flex justify-content-between align-items-center flex-wrap">
                                    <h5>–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫—É—Ä—Å—ã</h5>
                                    <div class="d-flex flex-wrap gap-2 align-items-center">
                                        <input type="text"
                                               id="courseSearch"
                                               class="form-control form-control-sm"
                                               style="width: 200px;"
                                               placeholder="–ü–æ–∏—Å–∫ –∫—É—Ä—Å–∞..."
                                               data-action="search"
                                               oninput="applyFiltersAndLoad()">
                                        <select id="categoryFilter" class="form-select form-select-sm" style="width: auto; min-width: 150px;" onchange="applyFiltersAndLoad()">
                                            <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                                        </select>
                                        <select id="statusFilter" class="form-select form-select-sm" style="width: auto; min-width: 150px;" onchange="applyFiltersAndLoad()">
                                            <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                                            <option value="–ê–∫—Ç–∏–≤–Ω—ã–π">–ê–∫—Ç–∏–≤–Ω—ã–π</option>
                                            <option value="–ó–∞–≤–µ—Ä—à–µ–Ω">–ó–∞–≤–µ—Ä—à–µ–Ω</option>
                                            <option value="–ù–∞–±–æ—Ä">–ù–∞–±–æ—Ä</option>
                                        </select>
                                        <div class="d-inline-flex align-items-center gap-1">
                                            <label class="form-label small mb-0">–¶–µ–Ω–∞:</label>
                                            <input type="number" id="minPrice" class="form-control form-control-sm" style="width: 80px;" placeholder="–æ—Ç" min="0" onchange="applyFiltersAndLoad()">
                                            <span>-</span>
                                            <input type="number" id="maxPrice" class="form-control form-control-sm" style="width: 80px;" placeholder="–¥–æ" min="0" onchange="applyFiltersAndLoad()">
                                        </div>
                                        <select id="itemsPerPage" class="form-select form-select-sm" style="width: auto;" onchange="setItemsPerPage(this.value)">
                                            <option value="5">5 –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ</option>
                                            <option value="10" selected>10 –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ</option>
                                            <option value="20">20 –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ</option>
                                            <option value="50">50 –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ</option>
                                        </select>
                                        <button class="btn btn-outline-primary btn-sm" onclick="loadAllCourses()">
                                            <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å
                                        </button>
                                        <button class="btn btn-outline-secondary btn-sm" onclick="saveCurrentFilters()">
                                            <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div id="coursesList">
                                    <p class="text-muted text-center">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –∫—É—Ä—Å–æ–≤...</p>
                                </div>
                                <div id="paginationContainer" class="mt-3 d-flex justify-content-center"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            
            <div class="tab-pane fade" id="my-courses" role="tabpanel" aria-labelledby="my-courses-tab">
                <div class="row mt-4">
                    <div class="col-12">
                        <h3>–ú–æ–∏ –∫—É—Ä—Å—ã</h3>
                        <p class="text-muted">–ó–¥–µ—Å—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –∫—É—Ä—Å—ã, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –∑–∞–ø–∏—Å–∞–ª–∏—Å—å.</p>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5>–ó–∞–ø–∏—Å–∞–Ω–Ω—ã–µ –∫—É—Ä—Å—ã</h5>
                                <button class="btn btn-outline-primary btn-sm" onclick="loadMyCourses()">
                                    <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å
                                </button>
                            </div>
                            <div class="card-body">
                                <div id="myCoursesList">
                                    <p class="text-muted text-center">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –≤–∞—à–∏—Ö –∫—É—Ä—Å–æ–≤...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            
            <div class="tab-pane fade" id="calendar" role="tabpanel" aria-labelledby="calendar-tab">
                <div class="row mt-4">
                    <div class="col-12">
                        <h3>–ö–∞–ª–µ–Ω–¥–∞—Ä—å –∑–∞–¥–∞–Ω–∏–π</h3>
                        <p class="text-muted">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–µ–¥–ª–∞–π–Ω–æ–≤ –∑–∞–¥–∞–Ω–∏–π –Ω–∞ –Ω–µ–¥–µ–ª—é</p>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5>–ù–µ–¥–µ–ª—å–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h5>
                                <div>
                                    <button class="btn btn-outline-secondary btn-sm" onclick="previousWeek()">
                                        <i class="fas fa-chevron-left"></i> –ü—Ä–µ–¥—ã–¥—É—â–∞—è
                                    </button>
                                    <button class="btn btn-outline-secondary btn-sm mx-2" onclick="currentWeek()">
                                        <i class="fas fa-calendar-day"></i> –¢–µ–∫—É—â–∞—è –Ω–µ–¥–µ–ª—è
                                    </button>
                                    <button class="btn btn-outline-secondary btn-sm" onclick="nextWeek()">
                                        –°–ª–µ–¥—É—é—â–∞—è <i class="fas fa-chevron-right"></i>
                                    </button>
                                    <button class="btn btn-outline-primary btn-sm ms-2" onclick="loadCalendar()">
                                        <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div id="calendarContainer">
                                    <p class="text-muted text-center">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä—è...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            
            <div class="tab-pane fade" id="certificates" role="tabpanel" aria-labelledby="certificates-tab">
                <div class="row mt-4">
                    <div class="col-12">
                        <h3>–ú–æ–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã</h3>
                        <p class="text-muted">–ó–¥–µ—Å—å –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤—Å–µ –≤–∞—à–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–∏ –∫—É—Ä—Å–æ–≤.</p>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5>–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã</h5>
                                <button class="btn btn-outline-primary btn-sm" onclick="loadCertificates()">
                                    <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å
                                </button>
                            </div>
                            <div class="card-body">
                                <div id="certificatesList">
                                    <p class="text-muted text-center">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            
            <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
                <div class="row mt-4">
                    <div class="col-12">
                        <h3>–ü—Ä–æ—Ñ–∏–ª—å —Å—Ç—É–¥–µ–Ω—Ç–∞</h3>
                        <p class="text-muted">–ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–≤–æ–µ–º –ø—Ä–æ—Ñ–∏–ª–µ.</p>
                    </div>
                </div>

                
                <ul class="nav nav-tabs mt-3" id="profileSubTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="personal-info-tab" data-bs-toggle="tab" data-bs-target="#personal-info" type="button" role="tab" aria-controls="personal-info" aria-selected="true">–õ–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="enrollments-tab" data-bs-toggle="tab" data-bs-target="#enrollments" type="button" role="tab" aria-controls="enrollments" aria-selected="false">–ó–∞–ø–∏—Å–∏</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="receipts-sub-tab" data-bs-toggle="tab" data-bs-target="#receipts-sub" type="button" role="tab" aria-controls="receipts-sub" aria-selected="false">–ß–µ–∫–∏</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="gift-cards-sub-tab" data-bs-toggle="tab" data-bs-target="#gift-cards-sub" type="button" role="tab" aria-controls="gift-cards-sub" aria-selected="false">–ü–æ–¥–∞—Ä–æ—á–Ω—ã–µ –∫–∞—Ä—Ç—ã</button>
                    </li>
                </ul>

                
                <div class="tab-content" id="profileSubTabsContent">
                    
                    <div class="tab-pane fade show active" id="personal-info" role="tabpanel" aria-labelledby="personal-info-tab">
                <div class="row mt-3">
                    <div class="col-md-8 mx-auto">
                        <div class="card">
                            <div class="card-header">
                                        <h5>–õ–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h5>
                            </div>
                            <div class="card-body">
                                <div id="profileInfo">
                                    <p class="text-muted text-center">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–æ—Ñ–∏–ª–µ...</p>
                                </div>
                                <div class="mt-3 text-center">
                                            <a href="/profile/edit" class="btn btn-primary mb-2">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</a>
                                            <br>
                                            <button class="btn btn-outline-warning" onclick="requestPasswordResetFromProfile()">
                                                <i class="fas fa-key"></i> –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–æ–ª—å
                                            </button>
                                            <div id="passwordResetMessage" class="mt-2"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    
                    <div class="tab-pane fade" id="enrollments" role="tabpanel" aria-labelledby="enrollments-tab">
                        <div class="row mt-3">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h5>–ú–æ–∏ –∑–∞–ø–∏—Å–∏</h5>
                                        <button class="btn btn-outline-primary btn-sm" onclick="loadMyEnrollments()">
                                            <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å
                                        </button>
                                    </div>
                                    <div class="card-body">
                                        <div id="enrollmentsList">
                                            <p class="text-muted text-center">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –∑–∞–ø–∏—Å–µ–π...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    
                    <div class="tab-pane fade" id="receipts-sub" role="tabpanel" aria-labelledby="receipts-sub-tab">
                        <div class="row mt-3">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h5>–ú–æ–∏ —á–µ–∫–∏</h5>
                                        <button class="btn btn-outline-primary btn-sm" onclick="loadMyReceipts()">
                                            <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å
                                        </button>
                                    </div>
                                    <div class="card-body">
                                        <div id="receiptsList">
                                            <p class="text-muted text-center">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —á–µ–∫–æ–≤...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    
                    <div class="tab-pane fade" id="gift-cards-sub" role="tabpanel" aria-labelledby="gift-cards-sub-tab">
                        <div class="row mt-3">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h5>–ú–æ–∏ –ø–æ–¥–∞—Ä–æ—á–Ω—ã–µ –∫–∞—Ä—Ç—ã</h5>
                                        <button class="btn btn-outline-primary btn-sm" onclick="loadMyGiftCards()">
                                            <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å
                                        </button>
                                    </div>
                                    <div class="card-body">
                                        <div id="giftCardsList">
                                            <p class="text-muted text-center">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –ø–æ–¥–∞—Ä–æ—á–Ω—ã—Ö –∫–∞—Ä—Ç...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {

            loadAllCourses();
            loadCategories();
        });

        function loadCategories() {
            fetch('/v1/api/categories', {
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('token')
                }
            })
            .then(response => response.json())
            .then(categories => {
                const categoryFilter = document.getElementById('categoryFilter');
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.categoryId;
                    option.textContent = category.categoryName;
                    categoryFilter.appendChild(option);
                });
            })
            .catch(error => {
                console.error('Error loading categories:', error);
            });
        }

        function filterCoursesByCategory() {
            const categoryId = document.getElementById('categoryFilter').value;
            if (categoryId) {
                loadCoursesByCategory(categoryId);
            } else {
                loadAllCourses();
            }
        }

        function loadCoursesByCategory(categoryId) {
            fetch(`/v1/api/courses/category/${categoryId}`, {
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('token')
                }
            })
            .then(response => response.json())
            .then(courses => {
                const coursesList = document.getElementById('coursesList');
                if (courses.length === 0) {
                    coursesList.innerHTML = '<p class="text-muted text-center">–ü–æ–∫–∞ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫—É—Ä—Å–æ–≤ –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</p>';
                } else {
                    let html = '<div class="row">';
                    courses.forEach(course => {

                        const categoryBadge = course.category ? 
                            `<span class="badge bg-info me-2">${course.category.categoryName}</span>` : '';
                        
                        html += `
                            <div class="col-md-6 col-lg-4 mb-4">
                                <div class="card course-card h-100">
                                    ${course.imageUrl ? 
                                        `<img src="${course.imageUrl}" class="card-img-top" style="width: 100%; height: 150px; object-fit: cover;" alt="${course.title}">` : 
                                        `<div class="bg-light" style="width: 100%; height: 150px; display: flex; align-items: center; justify-content: center;">
                                            <i class="fas fa-image fa-3x text-muted"></i>
                                        </div>`}
                                    <div class="card-body d-flex flex-column">
                                        <h5 class="card-title">
                                            ${categoryBadge}
                                            ${course.title}
                                        </h5>
                                        <p class="card-text flex-grow-1">${course.description || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è'}</p>
                                        <div class="mt-auto">
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <small class="text-muted">–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å: ${course.teacher ? course.teacher.firstName + ' ' + course.teacher.lastName : '–ù–µ —É–∫–∞–∑–∞–Ω'}</small>
                                                <span class="badge bg-success">${course.price ? course.price + ' —Ä—É–±.' : '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ'}</span>
                                            </div>
                                            ${course.courseStatus ? `<div class="mb-2"><small class="text-muted">–°—Ç–∞—Ç—É—Å: <span class="badge bg-info">${course.courseStatus.statusName}</span></small></div>` : ''}
                                            ${course.startDate ? `<div class="mb-2"><small class="text-muted">–ù–∞—á–∞–ª–æ: <span class="fw-bold text-primary">${new Date(course.startDate).toLocaleDateString('ru-RU')}</span></small></div>` : ''}
                                            ${course.endDate ? `<div class="mb-2"><small class="text-muted">–û–∫–æ–Ω—á–∞–Ω–∏–µ: <span class="fw-bold text-primary">${new Date(course.endDate).toLocaleDateString('ru-RU')}</span></small></div>` : ''}
                                            ${course.capacity ? `<div class="mb-2"><small class="text-muted">–°—Ç—É–¥–µ–Ω—Ç–æ–≤: ${course.enrolledCount || 0}/${course.capacity}</small></div>` : ''}
                                            <div class="d-grid gap-2">
                                                <a href="/student/course/${course.courseId}" class="btn btn-outline-primary">
                                                    <i class="fas fa-info-circle"></i> –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    html += '</div>';
                    coursesList.innerHTML = html;
                }
            })
            .catch(error => {
                document.getElementById('coursesList').innerHTML = '<p class="text-danger text-center">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ –∫—É—Ä—Å–æ–≤</p>';
            });
        }

        function loadAllCourses() {
            fetch('/v1/api/courses', {
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('token')
                }
            })
            .then(response => response.json())
            .then(courses => {

                const categoryFilter = document.getElementById('categoryFilter');
                const selectedCategory = categoryFilter ? categoryFilter.value : '';
                if (selectedCategory) {
                    courses = courses.filter(course => 
                        course.category && course.category.categoryId.toString() === selectedCategory
                    );
                }

                const priceMinInput = document.getElementById('priceMin');
                const priceMaxInput = document.getElementById('priceMax');
                const priceMin = priceMinInput && priceMinInput.value ? parseFloat(priceMinInput.value) : null;
                const priceMax = priceMaxInput && priceMaxInput.value ? parseFloat(priceMaxInput.value) : null;
                
                if (priceMin !== null || priceMax !== null) {
                    courses = courses.filter(course => {
                        const coursePrice = course.price || 0;
                        if (priceMin !== null && coursePrice < priceMin) {
                            return false;
                        }
                        if (priceMax !== null && coursePrice > priceMax) {
                            return false;
                        }
                        return true;
                    });
                }
                
                const coursesList = document.getElementById('coursesList');
                if (courses.length === 0) {
                    coursesList.innerHTML = '<p class="text-muted text-center">–ü–æ–∫–∞ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫—É—Ä—Å–æ–≤</p>';
                } else {
                    let html = '<div class="row">';
                    courses.forEach(course => {

                        const categoryBadge = course.category ? 
                            `<span class="badge bg-info me-2">${course.category.categoryName}</span>` : '';
                        
                        html += `
                            <div class="col-md-6 col-lg-4 mb-4">
                                <div class="card course-card h-100">
                                    ${course.imageUrl ? 
                                        `<img src="${course.imageUrl}" class="card-img-top" style="width: 100%; height: 150px; object-fit: cover;" alt="${course.title}">` : 
                                        `<div class="bg-light" style="width: 100%; height: 150px; display: flex; align-items: center; justify-content: center;">
                                            <i class="fas fa-image fa-3x text-muted"></i>
                                        </div>`}
                                    <div class="card-body d-flex flex-column">
                                        <h5 class="card-title">
                                            ${categoryBadge}
                                            ${course.title}
                                        </h5>
                                        <p class="card-text flex-grow-1">${course.description || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è'}</p>
                                        <div class="mt-auto">
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <small class="text-muted">–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å: ${course.teacher ? course.teacher.firstName + ' ' + course.teacher.lastName : '–ù–µ —É–∫–∞–∑–∞–Ω'}</small>
                                                <span class="badge bg-success">${course.price ? course.price + ' —Ä—É–±.' : '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ'}</span>
                                            </div>
                                            ${course.courseStatus ? `<div class="mb-2"><small class="text-muted">–°—Ç–∞—Ç—É—Å: <span class="badge bg-info">${course.courseStatus.statusName}</span></small></div>` : ''}
                                            ${course.startDate ? `<div class="mb-2"><small class="text-muted">–ù–∞—á–∞–ª–æ: <span class="fw-bold text-primary">${new Date(course.startDate).toLocaleDateString('ru-RU')}</span></small></div>` : ''}
                                            ${course.endDate ? `<div class="mb-2"><small class="text-muted">–û–∫–æ–Ω—á–∞–Ω–∏–µ: <span class="fw-bold text-primary">${new Date(course.endDate).toLocaleDateString('ru-RU')}</span></small></div>` : ''}
                                            ${course.capacity ? `<div class="mb-2"><small class="text-muted">–°—Ç—É–¥–µ–Ω—Ç–æ–≤: ${course.enrolledCount || 0}/${course.capacity}</small></div>` : ''}
                                            <div class="d-grid gap-2">
                                                <a href="/student/course/${course.courseId}" class="btn btn-outline-primary">
                                                    <i class="fas fa-info-circle"></i> –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    html += '</div>';
                    coursesList.innerHTML = html;
                }
            })
            .catch(error => {
                document.getElementById('coursesList').innerHTML = '<p class="text-danger text-center">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ –∫—É—Ä—Å–æ–≤</p>';
            });
        }

        function loadMyCourses() {

            fetch('/v1/api/courses/my/enrollments', {
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('token')
                }
            })
            .then(response => response.json())
            .then(enrollments => {
                const coursesList = document.getElementById('myCoursesList');
                if (enrollments.length === 0) {
                    coursesList.innerHTML = '<p class="text-muted text-center">–í—ã –ø–æ–∫–∞ –Ω–µ –∑–∞–ø–∏—Å–∞–ª–∏—Å—å –Ω–∏ –Ω–∞ –æ–¥–∏–Ω –∫—É—Ä—Å</p>';
                } else {
                    let html = '<div class="row">';
                    enrollments.forEach(enrollment => {
                        const course = enrollment.course;
                        if (!course) return;

                        const categoryBadge = course.category ? 
                            `<span class="badge bg-info me-2">${course.category.categoryName}</span>` : '';

                        const isEnrollmentActive = enrollment.enrollmentStatus && 
                            (enrollment.enrollmentStatus.statusName === "–ê–∫—Ç–∏–≤–µ–Ω" || 
                             enrollment.enrollmentStatus.statusName === "–ê–∫—Ç–∏–≤–Ω—ã–π" || 
                             enrollment.enrollmentStatus.statusName === "–ê–∫—Ç–∏–≤–Ω–∞" || 
                             enrollment.enrollmentStatus.statusName === "Active");
                        
                        const buttonClass = isEnrollmentActive ? 'btn-primary' : 'btn-secondary disabled';
                        const buttonText = isEnrollmentActive ? '<i class="fas fa-book-open"></i> –ü–µ—Ä–µ–π—Ç–∏ –∫ –∫—É—Ä—Å—É' :
                                                 '<i class="fas fa-clock"></i> –û–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è';
                        const buttonAction = isEnrollmentActive ? `href="/student/course/${course.courseId}"` : 'href="javascript:void(0)"';
                        const buttonOnclick = isEnrollmentActive ? '' : 'onclick="showPendingMessage(); return false;"';

                        const statusText = enrollment.enrollmentStatus ? enrollment.enrollmentStatus.statusName : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                        const statusClass = isEnrollmentActive ? 'text-success' : 'text-warning';

                        html += `
                            <div class="col-md-6 col-lg-4 mb-4">
                                <div class="card course-card h-100">
                                    ${course.imageUrl ? 
                                        `<img src="${course.imageUrl}" class="card-img-top" style="width: 100%; height: 150px; object-fit: cover;" alt="${course.title}">` : 
                                        `<div class="bg-light" style="width: 100%; height: 150px; display: flex; align-items: center; justify-content: center;">
                                            <i class="fas fa-image fa-3x text-muted"></i>
                                        </div>`}
                                    <div class="card-body d-flex flex-column">
                                        <h5 class="card-title">
                                            ${categoryBadge}
                                            ${course.title}
                                        </h5>
                                        <p class="card-text flex-grow-1">${course.description || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è'}</p>
                                        <div class="mt-auto">
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <small class="text-muted">–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å: ${course.teacher ? course.teacher.firstName + ' ' + course.teacher.lastName : '–ù–µ —É–∫–∞–∑–∞–Ω'}</small>
                                                <span class="badge bg-success">${course.price ? course.price + ' —Ä—É–±.' : '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ'}</span>
                                            </div>
                                            ${course.courseStatus ? `<div class="mb-2"><small class="text-muted">–°—Ç–∞—Ç—É—Å: <span class="badge bg-info">${course.courseStatus.statusName}</span></small></div>` : ''}
                                            ${course.startDate ? `<div class="mb-2"><small class="text-muted">–ù–∞—á–∞–ª–æ: <span class="fw-bold text-primary">${new Date(course.startDate).toLocaleDateString('ru-RU')}</span></small></div>` : ''}
                                            ${course.endDate ? `<div class="mb-2"><small class="text-muted">–û–∫–æ–Ω—á–∞–Ω–∏–µ: <span class="fw-bold text-primary">${new Date(course.endDate).toLocaleDateString('ru-RU')}</span></small></div>` : ''}
                                            ${course.capacity ? `<div class="mb-2"><small class="text-muted">–°—Ç—É–¥–µ–Ω—Ç–æ–≤: ${course.enrolledCount || 0}/${course.capacity}</small></div>` : ''}
                                            <div class="mb-2">
                                                <small class="${statusClass}"><strong>–°—Ç–∞—Ç—É—Å –∑–∞–ø–∏—Å–∏: ${statusText}</strong></small>
                                            </div>
                                            <div class="d-grid gap-2">
                                                <a ${buttonAction} class="btn ${buttonClass}" ${buttonOnclick}>
                                                    ${buttonText}
                                                </a>
                                                <a href="/student/course/${course.courseId}" class="btn btn-outline-primary">
                                                    <i class="fas fa-info-circle"></i> –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    html += '</div>';
                    coursesList.innerHTML = html;
                }
            })
            .catch(error => {
                document.getElementById('myCoursesList').innerHTML = '<p class="text-danger text-center">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ –≤–∞—à–∏—Ö –∫—É—Ä—Å–æ–≤</p>';
            });
        }

        function loadMyEnrollments() {

            fetch('/v1/api/courses/my/enrollments', {
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('token')
                }
            })
            .then(response => response.json())
            .then(enrollments => {
                const enrollmentsList = document.getElementById('enrollmentsList');
                if (enrollments.length === 0) {
                    enrollmentsList.innerHTML = '<p class="text-muted text-center">–í—ã –ø–æ–∫–∞ –Ω–µ –∑–∞–ø–∏—Å–∞–ª–∏—Å—å –Ω–∏ –Ω–∞ –æ–¥–∏–Ω –∫—É—Ä—Å</p>';
                } else {
                    let html = `
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>–ö—É—Ä—Å</th>
                                        <th>–î–∞—Ç–∞ –∑–∞–ø–∏—Å–∏</th>
                                        <th>–°—Ç–∞—Ç—É—Å</th>
                                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    enrollments.forEach(enrollment => {
                        const course = enrollment.course;
                        if (!course) return; // Skip if no course data

                        const isEnrollmentActive = enrollment.enrollmentStatus && 
                            (enrollment.enrollmentStatus.statusName === "–ê–∫—Ç–∏–≤–µ–Ω" || 
                             enrollment.enrollmentStatus.statusName === "–ê–∫—Ç–∏–≤–Ω—ã–π" || 
                             enrollment.enrollmentStatus.statusName === "–ê–∫—Ç–∏–≤–Ω–∞" || 
                             enrollment.enrollmentStatus.statusName === "Active");
                        
                        const buttonText = isEnrollmentActive ? '–ü–µ—Ä–µ–π—Ç–∏ –∫ –∫—É—Ä—Å—É' : '–û–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è';
                        const buttonAction = isEnrollmentActive ? `href="/student/course/${course.courseId}"` : 'href="javascript:void(0)"';
                        const buttonOnclick = isEnrollmentActive ? '' : 'onclick="showPendingMessage(); return false;"';
                        const buttonClass = isEnrollmentActive ? 'btn-primary' : 'btn-secondary disabled';

                        const statusText = enrollment.enrollmentStatus ? enrollment.enrollmentStatus.statusName : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                        const statusClass = isEnrollmentActive ? 'text-success' : 'text-warning';

                        html += `
                            <tr>
                                <td>${course.title || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                                <td>${enrollment.enrollmentDate ? new Date(enrollment.enrollmentDate).toLocaleDateString('ru-RU') : '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</td>
                                <td><span class="${statusClass}">${statusText}</span></td>
                                <td>
                                    <a ${buttonAction} class="btn btn-sm ${buttonClass}" ${buttonOnclick}>
                                        ${buttonText}
                                    </a>
                                </td>
                            </tr>
                        `;
                    });
                    
                    html += `
                                </tbody>
                            </table>
                        </div>
                    `;
                    
                    enrollmentsList.innerHTML = html;
                }
            })
            .catch(error => {
                document.getElementById('enrollmentsList').innerHTML = '<p class="text-danger text-center">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ –∑–∞–ø–∏—Å–µ–π</p>';
            });
        }

        function loadMyReceipts() {
            fetch('/v1/api/courses/my/checks', {
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('token')
                }
            })
            .then(response => response.json())
            .then(checks => {
                const receiptsList = document.getElementById('receiptsList');
                if (checks.length === 0) {
                    receiptsList.innerHTML = '<p class="text-muted text-center">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —á–µ–∫–æ–≤</p>';
                } else {
                    let html = `
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>–ù–æ–º–µ—Ä —á–µ–∫–∞</th>
                                        <th>–ö—É—Ä—Å</th>
                                        <th>–°—É–º–º–∞</th>
                                        <th>–î–∞—Ç–∞ –æ–ø–ª–∞—Ç—ã</th>
                                        <th>–°—Ç–∞—Ç—É—Å</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    checks.forEach(check => {

                        const courseName = check.course ? check.course.title : '–ü–æ–¥–∞—Ä–æ—á–Ω–∞—è –∫–∞—Ä—Ç–∞';
                        html += `
                            <tr>
                                <td>${check.checkId || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                                <td>${courseName}</td>
                                <td>${check.amount ? check.amount + ' —Ä—É–±.' : '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</td>
                                <td>${check.paymentDate ? new Date(check.paymentDate).toLocaleDateString('ru-RU') : '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</td>
                                <td>${check.paymentStatus ? check.paymentStatus.statusName : '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                            </tr>
                        `;
                    });
                    
                    html += `
                                </tbody>
                            </table>
                        </div>
                    `;
                    
                    receiptsList.innerHTML = html;
                }
            })
            .catch(error => {
                document.getElementById('receiptsList').innerHTML = '<p class="text-danger text-center">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ —á–µ–∫–æ–≤</p>';
            });
        }

        function loadMyGiftCards() {
            fetch('/v1/api/gift-cards/my', {
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('token')
                }
            })
            .then(response => response.json())
            .then(giftCards => {
                const giftCardsList = document.getElementById('giftCardsList');
                if (giftCards.length === 0) {
                    giftCardsList.innerHTML = '<p class="text-muted text-center">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø–æ–¥–∞—Ä–æ—á–Ω—ã—Ö –∫–∞—Ä—Ç</p>';
                } else {
                    let html = '<div class="row">';
                    giftCards.forEach(card => {
                        const statusBadge = card.giftCardStatus && card.giftCardStatus.statusName === '–ê–∫—Ç–∏–≤–Ω–∞' 
                            ? '<span class="badge bg-success">–ê–∫—Ç–∏–≤–Ω–∞</span>' 
                            : card.giftCardStatus && card.giftCardStatus.statusName === '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞'
                            ? '<span class="badge bg-secondary">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞</span>'
                            : '<span class="badge bg-secondary">' + (card.giftCardStatus ? card.giftCardStatus.statusName : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ') + '</span>';
                        
                        const courseName = card.course ? card.course.title : '–ù–µ —É–∫–∞–∑–∞–Ω';
                        
                        html += `
                            <div class="col-md-6 col-lg-4 mb-4">
                                <div class="card h-100">
                                    <div class="card-body text-center">
                                        <i class="fas fa-gift fa-4x text-primary mb-3"></i>
                                        <h5 class="card-title">–ü–æ–¥–∞—Ä–æ—á–Ω–∞—è –∫–∞—Ä—Ç–∞</h5>
                                        ${card.course ? `<p class="card-text"><strong>–ö—É—Ä—Å: ${courseName}</strong></p>` : ''}
                                        <div class="mb-3">
                                            <label class="form-label text-muted small">–ö–æ–¥ –∫–∞—Ä—Ç—ã:</label>
                                            <div class="input-group">
                                                <input type="text" class="form-control text-center fw-bold" id="cardCode-${card.giftCardId}" value="${card.code || card.cardNumber}" readonly>
                                                <button class="btn btn-outline-secondary" type="button" onclick="copyCardCode('${card.code || card.cardNumber}')" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥">
                                                    <i class="fas fa-copy"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <p class="card-text">
                                            <strong>–ë–∞–ª–∞–Ω—Å: ${card.balance} —Ä—É–±.</strong>
                                        </p>
                                        <p class="card-text">
                                            <small class="text-muted">–í—ã–ø—É—â–µ–Ω–∞: ${new Date(card.issueDate).toLocaleDateString('ru-RU')}</small>
                                        </p>
                                        <p class="card-text">
                                            <small class="text-muted">–î–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞ –¥–æ: ${card.expiryDate ? new Date(card.expiryDate).toLocaleDateString('ru-RU') : '–ù–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞'}</small>
                                        </p>
                                        <div class="mt-2">
                                            ${statusBadge}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    html += '</div>';
                    giftCardsList.innerHTML = html;
                }
            })
            .catch(error => {
                console.error('Error loading gift cards:', error);
                document.getElementById('giftCardsList').innerHTML = '<p class="text-danger text-center">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ –ø–æ–¥–∞—Ä–æ—á–Ω—ã—Ö –∫–∞—Ä—Ç</p>';
            });
        }


        function copyCardCode(cardNumber) {
            navigator.clipboard.writeText(cardNumber).then(() => {
                alert('–ö–æ–¥ –∫–∞—Ä—Ç—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω: ' + cardNumber);
            }).catch(err => {
                console.error('Failed to copy:', err);

                const textArea = document.createElement('textarea');
                textArea.value = cardNumber;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    alert('–ö–æ–¥ –∫–∞—Ä—Ç—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω: ' + cardNumber);
                } catch (err) {
                    alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥. –ö–æ–¥ –∫–∞—Ä—Ç—ã: ' + cardNumber);
                }
                document.body.removeChild(textArea);
            });
        }

        function requestPasswordResetFromProfile() {
            const messageDiv = document.getElementById('passwordResetMessage');
            messageDiv.innerHTML = '<div class="alert alert-info">–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è...</div>';
            
            const token = localStorage.getItem('token');
            if (!token) {

                window.location.href = '/login?sessionExpired=true';
                return;
            }

            fetch('/v1/api/auth/me', {
                headers: {
                    'Authorization': 'Bearer ' + token
                }
            })
            .then(response => {
                if (response.status === 401 || !response.ok) {

                    window.location.href = '/login?sessionExpired=true';
                    return null;
                }
                return response.json();
            })
            .then(user => {
                if (!user) {
                    return; // –£–∂–µ –ø—Ä–æ–∏–∑–æ—à–µ–ª —Ä–µ–¥–∏—Ä–µ–∫—Ç
                }
                
                if (!user.email) {
                    throw new Error('Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω');
                }

                const formData = new FormData();
                formData.append('email', user.email);
                
                return fetch('/forgot-password', {
                    method: 'POST',
                    body: formData
                });
            })
            .then(response => {
                if (!response) {
                    return null; // –£–∂–µ –ø—Ä–æ–∏–∑–æ—à–µ–ª —Ä–µ–¥–∏—Ä–µ–∫—Ç
                }
                return response.json();
            })
            .then(data => {
                if (!data) {
                    return; // –£–∂–µ –ø—Ä–æ–∏–∑–æ—à–µ–ª —Ä–µ–¥–∏—Ä–µ–∫—Ç
                }
                
                if (data && data.message) {
                    messageDiv.innerHTML = '<div class="alert alert-success">' + data.message + '</div>';
                } else if (data && data.error) {
                    messageDiv.innerHTML = '<div class="alert alert-danger">' + data.error + '</div>';
                } else {
                    messageDiv.innerHTML = '<div class="alert alert-danger">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞</div>';
                }
            })
            .catch(error => {
                console.error('Error:', error);
                messageDiv.innerHTML = '<div class="alert alert-danger">–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: ' + (error.message || '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ') + '</div>';
            });
        }

        function loadProfile() {
            fetch('/v1/api/auth/me', {
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('token')
                }
            })
            .then(response => response.json())
            .then(user => {
                const profileInfo = document.getElementById('profileInfo');
                profileInfo.innerHTML = `
                    <div class="row">
                        <div class="col-md-4">
                            <div class="text-center mb-3">
                                ${user.imageUrl ? 
                                    `<img src="${user.imageUrl}" class="rounded-circle" style="width: 100px; height: 100px; object-fit: cover;" alt="Profile image">` : 
                                    `<div class="bg-light rounded-circle d-flex align-items-center justify-content-center mx-auto" style="width: 100px; height: 100px;">
                                        <i class="fas fa-user fa-3x text-secondary"></i>
                                    </div>`}
                                <h5 class="mt-2">${user.firstName} ${user.lastName}</h5>
                                <p class="text-muted">${user.role ? user.role.roleName : '–°—Ç—É–¥–µ–Ω—Ç'}</p>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <h5>–õ–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h5>
                            <table class="table table-borderless">
                                <tr>
                                    <td><strong>–ò–º—è:</strong></td>
                                    <td>${user.firstName || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</td>
                                </tr>
                                <tr>
                                    <td><strong>–§–∞–º–∏–ª–∏—è:</strong></td>
                                    <td>${user.lastName || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</td>
                                </tr>
                                <tr>
                                    <td><strong>–û—Ç—á–µ—Å—Ç–≤–æ:</strong></td>
                                    <td>${user.middleName || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</td>
                                </tr>
                                <tr>
                                    <td><strong>Email:</strong></td>
                                    <td>${user.email || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</td>
                                </tr>
                                <tr>
                                    <td><strong>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:</strong></td>
                                    <td>${user.registrationDate ? new Date(user.registrationDate).toLocaleDateString('ru-RU') : '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                `;
            })
            .catch(error => {
                document.getElementById('profileInfo').innerHTML = '<p class="text-danger text-center">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–æ—Ñ–∏–ª–µ</p>';
            });
        }

        document.getElementById('profile-tab').addEventListener('shown.bs.tab', function (e) {
            loadProfile();
        });

        document.getElementById('catalog-tab').addEventListener('shown.bs.tab', function (e) {
            loadAllCourses();
            loadCategories();
        });
        
        function filterCoursesByCategory() {
            loadAllCourses();
        }
        
        function loadCategories() {
            fetch('/v1/api/categories', {
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('token')
                }
            })
            .then(response => response.json())
            .then(categories => {
                const categoryFilter = document.getElementById('categoryFilter');
                if (categoryFilter) {

                    const currentValue = categoryFilter.value;

                    categoryFilter.innerHTML = '<option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>';

                    categories.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category.categoryId;
                        option.textContent = category.categoryName;
                        categoryFilter.appendChild(option);
                    });

                    categoryFilter.value = currentValue;
                }
            })
            .catch(error => {
                console.error('Error loading categories:', error);
            });
        }

        document.getElementById('my-courses-tab').addEventListener('shown.bs.tab', function (e) {
            loadMyCourses();
        });

        document.getElementById('calendar-tab').addEventListener('shown.bs.tab', function (e) {
            loadCalendar();
        });

        document.getElementById('enrollments-tab').addEventListener('shown.bs.tab', function (e) {
            loadMyEnrollments();
        });

        document.getElementById('receipts-sub-tab').addEventListener('shown.bs.tab', function (e) {
            loadMyReceipts();
        });

        document.getElementById('gift-cards-sub-tab').addEventListener('shown.bs.tab', function (e) {
            loadMyGiftCards();
        });

        function enrollInCourse(courseId) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —ç—Ç–æ—Ç –∫—É—Ä—Å?')) {
                fetch(`/v1/api/courses/${courseId}/enroll`, {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + localStorage.getItem('token'),
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => {
                    if (response.ok) {
                        alert('–í—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–ø–∏—Å–∞–ª–∏—Å—å –Ω–∞ –∫—É—Ä—Å!');

                        loadAllCourses();
                    } else {

                        response.text().then(text => {
                            try {
                                const errorData = JSON.parse(text);
                                alert(errorData.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –Ω–∞ –∫—É—Ä—Å');
                            } catch (e) {
                                alert(text || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –Ω–∞ –∫—É—Ä—Å');
                            }
                        }).catch(() => {
                        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –Ω–∞ –∫—É—Ä—Å');
                        });
                    }
                })
                .catch(error => {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –Ω–∞ –∫—É—Ä—Å: ' + (error.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                });
            }
        }

        function showPendingMessage() {
            alert('–í–∞—à–∞ –∑–∞–ø–∏—Å—å –Ω–∞ –∫—É—Ä—Å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏. –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–ø–ª–∞—Ç—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º, –∫—É—Ä—Å —Å—Ç–∞–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω.');
        }

        function viewCourse(courseId) {

            window.location.href = '/student/course/' + courseId;
        }

        let currentWeekStart = null;

        function getWeekStart(date) {
            const d = new Date(date);
            const day = d.getDay();
            const diff = d.getDate() - day + (day === 0 ? -6 : 1);
            return new Date(d.setDate(diff));
        }

        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function formatDateDisplay(date) {
            return date.toLocaleDateString('ru-RU', { weekday: 'short', day: 'numeric', month: 'short' });
        }

        function currentWeek() {
            currentWeekStart = getWeekStart(new Date());
            loadCalendar();
        }

        function previousWeek() {
            if (!currentWeekStart) {
                currentWeekStart = getWeekStart(new Date());
            }
            currentWeekStart = new Date(currentWeekStart);
            currentWeekStart.setDate(currentWeekStart.getDate() - 7);
            loadCalendar();
        }

        function nextWeek() {
            if (!currentWeekStart) {
                currentWeekStart = getWeekStart(new Date());
            }
            currentWeekStart = new Date(currentWeekStart);
            currentWeekStart.setDate(currentWeekStart.getDate() + 7);
            loadCalendar();
        }

        function loadCalendar() {
            if (!currentWeekStart) {
                currentWeekStart = getWeekStart(new Date());
            }
            
            const weekStartStr = formatDate(currentWeekStart);
            const calendarContainer = document.getElementById('calendarContainer');
            calendarContainer.innerHTML = '<p class="text-muted text-center">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä—è...</p>';

            fetch(`/v1/api/tasks/my/calendar?weekStart=${weekStartStr}`, {
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('token')
                }
            })
            .then(response => response.json())
            .then(tasks => {
                renderCalendar(tasks);
            })
            .catch(error => {
                console.error('Error loading calendar:', error);
                calendarContainer.innerHTML = '<p class="text-danger text-center">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—è</p>';
            });
        }

        function renderCalendar(tasks) {
            const calendarContainer = document.getElementById('calendarContainer');
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const weekStart = new Date(currentWeekStart);
            weekStart.setHours(0, 0, 0, 0);
            
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekEnd.getDate() + 6);
            
            let html = `
                <div class="mb-3">
                    <h5>–ù–µ–¥–µ–ª—è: ${formatDateDisplay(weekStart)} - ${formatDateDisplay(weekEnd)}</h5>
                </div>
                <div class="row g-2">
            `;
            
            for (let i = 0; i < 7; i++) {
                const dayDate = new Date(weekStart);
                dayDate.setDate(dayDate.getDate() + i);
                
                const dayStr = formatDate(dayDate);
                const dayTasks = tasks.filter(task => {
                    if (!task.deadline) return false;
                    const taskDate = new Date(task.deadline);
                    taskDate.setHours(0, 0, 0, 0);
                    return taskDate.getTime() === dayDate.getTime();
                });
                
                const isToday = dayDate.getTime() === today.getTime();
                const dayClass = isToday ? 'calendar-day today' : 'calendar-day';
                
                html += `
                    <div class="col-md">
                        <div class="${dayClass}">
                            <div class="calendar-day-header">
                                ${formatDateDisplay(dayDate)}
                            </div>
                            <div class="task-list">
                `;
                
                if (dayTasks.length === 0) {
                    html += '<p class="text-muted small">–ù–µ—Ç –∑–∞–¥–∞–Ω–∏–π</p>';
                } else {
                    dayTasks.forEach(task => {
                        const taskDate = new Date(task.deadline);
                        const daysUntilDeadline = Math.ceil((taskDate - today) / (1000 * 60 * 60 * 24));
                        let taskClass = 'task-item';
                        
                        if (daysUntilDeadline < 0) {
                            taskClass += ' urgent';
                        } else if (daysUntilDeadline <= 2) {
                            taskClass += ' warning';
                        }
                        
                        const courseName = task.lesson && task.lesson.course ? task.lesson.course.title : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∫—É—Ä—Å';
                        const lessonName = task.lesson ? task.lesson.title : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —É—Ä–æ–∫';
                        const courseId = task.lesson && task.lesson.course ? task.lesson.course.courseId : 0;
                        const lessonId = task.lesson ? task.lesson.lessonId : 0;
                        
                        if (courseId && lessonId) {
                            html += `
                                <div class="${taskClass}" onclick="viewTask(${courseId}, ${lessonId}, ${task.taskId})" title="${task.description || ''}">
                                    <strong>${task.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</strong><br>
                                    <small class="text-muted">${courseName}</small><br>
                                    <small class="text-muted">${lessonName}</small>
                                </div>
                            `;
                        } else {
                            html += `
                                <div class="${taskClass}" title="${task.description || ''}">
                                    <strong>${task.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</strong><br>
                                    <small class="text-muted">${courseName}</small><br>
                                    <small class="text-muted">${lessonName}</small>
                                </div>
                            `;
                        }
                    });
                }
                
                html += `
                            </div>
                        </div>
                    </div>
                `;
            }
            
            html += '</div>';
            calendarContainer.innerHTML = html;
        }

        function viewTask(courseId, lessonId, taskId) {
            window.location.href = `/student/course/${courseId}/lesson/${lessonId}/task/${taskId}`;
        }

        function loadCertificates() {
            const certificatesList = document.getElementById('certificatesList');
            certificatesList.innerHTML = '<p class="text-muted text-center">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤...</p>';

            fetch('/student/certificates', {
                method: 'GET',
                credentials: 'include' // –í–∞–∂–Ω–æ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ cookies/—Å–µ—Å—Å–∏–∏
            })
            .then(response => {
                if (!response.ok) {
                    if (response.status === 401 || response.status === 403) {
                        throw new Error('–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –≤–æ–π–¥–∏—Ç–µ –∑–∞–Ω–æ–≤–æ.');
                    }
                    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤');
                }
                return response.text();
            })
            .then(html => {

                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const certificatesContainer = doc.querySelector('#certificatesList');
                
                if (certificatesContainer) {
                    certificatesList.innerHTML = certificatesContainer.innerHTML;
                } else {

                    const bodyContent = doc.body ? doc.body.innerHTML : html;
                    certificatesList.innerHTML = bodyContent;
                }
            })
            .catch(error => {
                console.error('Error loading certificates:', error);
                certificatesList.innerHTML = '<div class="alert alert-danger text-center">' + error.message + '</div>';
            });
        }

        document.getElementById('certificates-tab').addEventListener('shown.bs.tab', function() {
            loadCertificates();
        });
    </script>
    
    <button id="themeToggleFloat" class="theme-toggle" onclick="toggleTheme()" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
        üåô
    </button>

    <script>

        let currentPage = 1;
        let totalPages = 1;
        let itemsPerPage = 10;
        let allCourses = [];

        document.addEventListener('DOMContentLoaded', function() {

            if (window.userSettings && window.userSettings.load) {
                window.userSettings.load().then(() => {

                    if (window.userSettings && window.userSettings.getSettings) {
                        const settings = window.userSettings.getSettings();
                        if (settings.itemsPerPage) {
                            itemsPerPage = parseInt(settings.itemsPerPage);

                            const itemsPerPageSelect = document.getElementById('itemsPerPage');
                            if (itemsPerPageSelect) {
                                itemsPerPageSelect.value = itemsPerPage;
                            }
                        }
                    }

                    loadCategories().then(() => {

                        if (window.userSettings && window.userSettings.getSettings) {
                            const settings = window.userSettings.getSettings();
                            if (settings.savedFilters) {
                                try {
                                    const filters = JSON.parse(settings.savedFilters);
                                    window.userSettings.applyFilters(filters);
                                } catch (e) {
                                    console.error('Error parsing saved filters:', e);
                                }
                            }
                        }

                        loadAllCourses();
                    });
                });
            } else {

                loadCategories();
                loadAllCourses();
            }
        });

        function applyFiltersAndLoad() {
            currentPage = 1; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –Ω–∞ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É

            if (window.userSettings) {
                const filters = window.userSettings.getCurrentFilters();
                window.userSettings.saveFilters(filters);
            }
            loadAllCourses();
        }

        function saveCurrentFilters() {
            if (window.userSettings) {
                const filters = window.userSettings.getCurrentFilters();
                window.userSettings.saveFilters(filters);
                alert('–§–∏–ª—å—Ç—Ä—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
            }
        }

        function setItemsPerPage(value) {
            itemsPerPage = parseInt(value);
            currentPage = 1;
            console.log('setItemsPerPage called with value:', value, 'itemsPerPage set to:', itemsPerPage);
            if (window.userSettings) {
                window.userSettings.setItemsPerPage(value);

                const filters = window.userSettings.getCurrentFilters();
                window.userSettings.saveFilters(filters);
            }
            loadAllCourses();
        }

        function loadAllCourses() {
            const categoryId = document.getElementById('categoryFilter')?.value || '';
            const minPrice = document.getElementById('minPrice')?.value || '';
            const maxPrice = document.getElementById('maxPrice')?.value || '';
            const status = document.getElementById('statusFilter')?.value || '';
            const searchTerm = (document.getElementById('courseSearch')?.value || '').toLowerCase().trim();

            fetch('/v1/api/courses', {
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('token')
                }
            })
            .then(response => response.json())
            .then(courses => {
                allCourses = courses;

                if (searchTerm) {
                    courses = courses.filter(course => (course.title || '').toLowerCase().includes(searchTerm));
                }
                let filteredCourses = courses.filter(course => {
                    if (categoryId && course.category?.categoryId != categoryId) return false;
                    if (status && course.courseStatus?.statusName !== status) return false;
                    if (minPrice && course.price < parseFloat(minPrice)) return false;
                    if (maxPrice && course.price > parseFloat(maxPrice)) return false;
                    return true;
                });

                totalPages = Math.ceil(filteredCourses.length / itemsPerPage);
                const startIndex = (currentPage - 1) * itemsPerPage;
                const endIndex = startIndex + itemsPerPage;
                const paginatedCourses = filteredCourses.slice(startIndex, endIndex);

                displayCourses(paginatedCourses);

                displayPagination(filteredCourses.length);
            })
            .catch(error => {
                console.error('Error loading courses:', error);
                document.getElementById('coursesList').innerHTML = '<p class="text-danger text-center">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫—É—Ä—Å–æ–≤</p>';
            });
        }

        function displayCourses(courses) {
            const coursesList = document.getElementById('coursesList');
            if (courses.length === 0) {
                coursesList.innerHTML = '<p class="text-muted text-center">–ö—É—Ä—Å—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
                return;
            }

            let html = '<div class="row">';
            courses.forEach(course => {

                const categoryBadge = course.category ? 
                    `<span class="badge bg-info me-2">${course.category.categoryName}</span>` : '';
                
                html += `
                    <div class="col-md-6 col-lg-4 mb-4">
                        <div class="card course-card h-100">
                            ${course.imageUrl ? 
                                `<img src="${course.imageUrl}" class="card-img-top" style="width: 100%; height: 150px; object-fit: cover;" alt="${course.title}">` : 
                                `<div class="bg-light" style="width: 100%; height: 150px; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-image fa-3x text-muted"></i>
                                </div>`}
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">
                                    ${categoryBadge}
                                    ${course.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}
                                </h5>
                                <p class="card-text flex-grow-1">${course.description || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è'}</p>
                                <div class="mt-auto">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <small class="text-muted">–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å: ${course.teacher ? course.teacher.firstName + ' ' + course.teacher.lastName : '–ù–µ —É–∫–∞–∑–∞–Ω'}</small>
                                        <span class="badge bg-success">${course.price ? course.price + ' —Ä—É–±.' : '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ'}</span>
                                    </div>
                                    ${course.courseStatus ? `<div class="mb-2"><small class="text-muted">–°—Ç–∞—Ç—É—Å: <span class="badge bg-info">${course.courseStatus.statusName}</span></small></div>` : ''}
                                    ${course.startDate ? `<div class="mb-2"><small class="text-muted">–ù–∞—á–∞–ª–æ: <span class="fw-bold text-primary">${new Date(course.startDate).toLocaleDateString('ru-RU')}</span></small></div>` : ''}
                                    ${course.endDate ? `<div class="mb-2"><small class="text-muted">–û–∫–æ–Ω—á–∞–Ω–∏–µ: <span class="fw-bold text-primary">${new Date(course.endDate).toLocaleDateString('ru-RU')}</span></small></div>` : ''}
                                    ${course.capacity ? `<div class="mb-2"><small class="text-muted">–°—Ç—É–¥–µ–Ω—Ç–æ–≤: ${course.enrolledCount || 0}/${course.capacity}</small></div>` : ''}
                                    <div class="d-grid gap-2">
                                        <a href="/student/course/${course.courseId}" class="btn btn-outline-primary">
                                            <i class="fas fa-info-circle"></i> –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            coursesList.innerHTML = html;
        }

        function displayPagination(totalItems) {
            const paginationContainer = document.getElementById('paginationContainer');
            if (totalPages <= 1) {
                paginationContainer.innerHTML = '';
                return;
            }

            let html = '<nav><ul class="pagination">';

            html += `<li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                <a class="page-link" href="#" onclick="goToPage(${currentPage - 1}); return false;">–ü—Ä–µ–¥—ã–¥—É—â–∞—è</a>
            </li>`;

            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                    html += `<li class="page-item ${i === currentPage ? 'active' : ''}">
                        <a class="page-link" href="#" onclick="goToPage(${i}); return false;">${i}</a>
                    </li>`;
                } else if (i === currentPage - 3 || i === currentPage + 3) {
                    html += '<li class="page-item disabled"><span class="page-link">...</span></li>';
                }
            }

            html += `<li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                <a class="page-link" href="#" onclick="goToPage(${currentPage + 1}); return false;">–°–ª–µ–¥—É—é—â–∞—è</a>
            </li>`;

            html += '</ul></nav>';
            html += `<p class="text-muted text-center mt-2">–ü–æ–∫–∞–∑–∞–Ω–æ ${((currentPage - 1) * itemsPerPage) + 1}-${Math.min(currentPage * itemsPerPage, totalItems)} –∏–∑ ${totalItems}</p>`;
            
            paginationContainer.innerHTML = html;
        }

        function goToPage(page) {
            if (page < 1 || page > totalPages) return;
            currentPage = page;
            loadAllCourses();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function loadCategories() {
            return fetch('/v1/api/categories', {
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('token')
                }
            })
            .then(response => response.json())
            .then(categories => {
                const categoryFilter = document.getElementById('categoryFilter');
                if (categoryFilter) {

                    const currentValue = categoryFilter.value;

                    categoryFilter.innerHTML = '<option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>';

                    categories.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category.categoryId;
                        option.textContent = category.categoryName;
                        categoryFilter.appendChild(option);
                    });

                    if (currentValue) {
                        categoryFilter.value = currentValue;
                    }
                }
                return categories;
            })
            .catch(error => {
                console.error('Error loading categories:', error);
                return [];
            });
        }

    </script>
</body>
</html>